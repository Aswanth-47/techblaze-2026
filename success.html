<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pay ‚Äî Tech Blaze 3.0</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@300;400;700&display=swap" rel="stylesheet">
  <!-- EmailJS ‚Äî sends email directly from browser, no backend needed -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <style>
    :root {
      --fire:#ff4500;--fire2:#ff8c00;--ember:#ffd700;
      --dark:#060402;--surface:#0d0a06;--muted:#6b5a3e;
      --text:#f0e6d3;--green:#22dd66;--border:rgba(255,140,0,0.12);
    }
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Syne',sans-serif;background:var(--dark);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px 16px;}
    #mainCanvas{position:fixed;inset:0;z-index:0;pointer-events:none;}
    .wrap{position:relative;z-index:5;width:100%;max-width:440px;display:flex;flex-direction:column;align-items:center;gap:20px;}

    /* Check */
    .check-circle{width:72px;height:72px;border-radius:50%;background:rgba(34,221,102,0.1);border:2px solid rgba(34,221,102,0.35);display:grid;place-items:center;box-shadow:0 0 32px rgba(34,221,102,0.2);opacity:0;animation:popIn .5s .1s cubic-bezier(.34,1.56,.64,1) forwards;}
    .check-circle svg{width:30px;height:30px;stroke:var(--green);stroke-width:2.5;fill:none;stroke-linecap:round;stroke-linejoin:round;}
    .check-path{stroke-dasharray:50;stroke-dashoffset:50;animation:drawCheck .4s .55s ease forwards;}

    /* Title */
    .title-block{text-align:center;opacity:0;animation:fadeUp .5s .3s forwards;}
    h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(40px,11vw,64px);line-height:.92;margin-bottom:8px;}
    .grad{background:linear-gradient(90deg,var(--fire),var(--fire2),var(--ember));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .tagline{font-size:13px;color:var(--muted);line-height:1.6;}

    /* Amount pill */
    .amount-pill{background:rgba(255,140,0,0.08);border:1px solid rgba(255,140,0,0.22);border-radius:14px;padding:14px 28px;text-align:center;opacity:0;animation:fadeUp .5s .42s forwards;width:100%;}
    .amount-label{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:.12em;text-transform:uppercase;margin-bottom:4px;}
    .amount-val{font-family:'Bebas Neue',sans-serif;font-size:48px;line-height:1;background:linear-gradient(90deg,var(--fire),var(--fire2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .amount-sub{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted);margin-top:2px;}

    /* Card base */
    .card{width:100%;background:var(--surface);border-radius:20px;padding:26px;position:relative;overflow:hidden;opacity:0;animation:fadeUp .5s forwards;}
    .card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--fire),var(--fire2),var(--ember));}
    .card:nth-of-type(1){animation-delay:.52s;border:1px solid rgba(255,140,0,0.2);}
    .card:nth-of-type(2){animation-delay:.64s;border:1px solid var(--border);}
    .card-label{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:.13em;text-transform:uppercase;margin-bottom:16px;text-align:center;}

    /* UPI ID */
    .upi-id-box{background:rgba(255,255,255,0.04);border:1.5px solid rgba(255,140,0,0.3);border-radius:13px;padding:18px 20px;text-align:center;margin-bottom:14px;}
    .upi-id-text{font-family:'JetBrains Mono',monospace;font-size:clamp(17px,4.5vw,22px);font-weight:700;color:var(--text);word-break:break-all;}
    .upi-hint{font-size:11px;color:var(--muted);margin-top:5px;font-family:'JetBrains Mono',monospace;}

    .btn-copy{width:100%;padding:14px;background:linear-gradient(135deg,var(--fire),var(--fire2));color:#fff;border:none;border-radius:12px;font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:.08em;cursor:pointer;box-shadow:0 6px 24px rgba(255,69,0,.35);transition:transform .2s,box-shadow .2s;position:relative;overflow:hidden;}
    .btn-copy::after{content:'';position:absolute;top:-50%;left:-60%;width:40%;height:200%;background:rgba(255,255,255,0.12);transform:skewX(-20deg);transition:left .5s;}
    .btn-copy:hover::after{left:130%;}
    .btn-copy:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(255,69,0,.5);}
    .btn-copy.done{background:linear-gradient(135deg,#22aa55,#22dd66);box-shadow:0 6px 24px rgba(34,221,102,.3);}

    .app-row{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:14px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:.06em;}
    .app-chip{padding:5px 11px;border-radius:20px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);font-size:12px;}

    /* Screenshot upload */
    .upload-zone{border:2px dashed rgba(255,140,0,0.25);border-radius:14px;padding:28px 20px;text-align:center;cursor:pointer;transition:all .25s;margin-bottom:14px;position:relative;}
    .upload-zone:hover,.upload-zone.drag{border-color:rgba(255,140,0,0.55);background:rgba(255,140,0,0.05);}
    .upload-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
    .upload-icon{font-size:32px;margin-bottom:8px;}
    .upload-text{font-size:14px;color:var(--text);font-weight:600;margin-bottom:4px;}
    .upload-sub{font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace;}

    /* Preview */
    .preview-wrap{display:none;position:relative;margin-bottom:14px;border-radius:12px;overflow:hidden;border:1px solid rgba(255,140,0,0.25);}
    .preview-wrap img{width:100%;display:block;max-height:260px;object-fit:contain;background:#0a0704;}
    .preview-remove{position:absolute;top:8px;right:8px;width:28px;height:28px;border-radius:8px;background:rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,0.15);color:#fff;font-size:14px;cursor:pointer;display:grid;place-items:center;transition:background .2s;}
    .preview-remove:hover{background:rgba(255,69,0,0.7);}

    /* Submit */
    .btn-submit{width:100%;padding:16px;background:linear-gradient(135deg,#25D366,#128C7E);color:#fff;border:none;border-radius:13px;font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:.07em;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 6px 24px rgba(37,211,102,.3);transition:transform .2s,box-shadow .2s,opacity .2s;}
    .btn-submit:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(37,211,102,.4);}
    .btn-submit:disabled{opacity:.5;cursor:not-allowed;transform:none;}
    .btn-submit svg{width:20px;height:20px;fill:#fff;flex-shrink:0;}

    /* Status messages */
    .status{display:none;border-radius:12px;padding:14px 18px;font-size:13px;font-family:'JetBrains Mono',monospace;line-height:1.6;margin-top:4px;text-align:center;}
    .status.sending{display:block;background:rgba(255,140,0,0.08);border:1px solid rgba(255,140,0,0.2);color:var(--fire2);}
    .status.sent{display:block;background:rgba(34,221,102,0.08);border:1px solid rgba(34,221,102,0.25);color:var(--green);}
    .status.err{display:block;background:rgba(255,69,0,0.08);border:1px solid rgba(255,69,0,0.2);color:var(--fire);}

    .back-row{opacity:0;animation:fadeUp .5s .8s forwards;}
    .back-row a{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted);text-decoration:none;transition:color .2s;}
    .back-row a:hover{color:var(--fire2);}

    @keyframes fadeUp  {from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
    @keyframes popIn   {from{opacity:0;transform:scale(.5)}to{opacity:1;transform:scale(1)}}
    @keyframes drawCheck{to{stroke-dashoffset:0}}
  </style>
</head>
<body>
<canvas id="mainCanvas"></canvas>

<div class="wrap">

  <!-- Check -->
  <div class="check-circle">
    <svg viewBox="0 0 24 24"><polyline class="check-path" points="4 13 9 18 20 7"/></svg>
  </div>

  <!-- Title -->
  <div class="title-block">
    <h1>Registered! <span class="grad">Now Pay</span></h1>
    <p class="tagline">Send ‚Çπ250 per member to the UPI ID below,<br>then upload your payment screenshot.</p>
  </div>

  <!-- Amount -->
  <div class="amount-pill">
    <div class="amount-label">Amount to Pay</div>
    <div class="amount-val" id="r-amount">‚Çπ‚Äî</div>
    <div class="amount-sub" id="r-sub">‚Äî member(s) √ó ‚Çπ250</div>
  </div>

  <!-- Step 1: UPI -->
  <div class="card">
    <div class="card-label">Step 1 ‚Äî Send Payment to UPI ID</div>
    <div class="upi-id-box">
      <div class="upi-id-text">aswanth2006@oksbi</div>
      <div class="upi-hint">Copy & paste in GPay ¬∑ PhonePe ¬∑ Paytm ¬∑ BHIM</div>
    </div>
    <button class="btn-copy" id="copyBtn" onclick="copyUPI()">üìã &nbsp;Copy UPI ID</button>
    <div class="app-row">Pay via ‚Üí <span class="app-chip">GPay</span><span class="app-chip">PhonePe</span><span class="app-chip">Paytm</span><span class="app-chip">BHIM</span></div>
  </div>

  <!-- Step 2: Screenshot upload -->
  <div class="card">
    <div class="card-label">Step 2 ‚Äî Upload Payment Screenshot</div>

    <div class="upload-zone" id="uploadZone">
      <input type="file" id="screenshotInput" accept="image/*" onchange="onFileChosen(event)">
      <div class="upload-icon">üì∏</div>
      <div class="upload-text">Tap to attach screenshot</div>
      <div class="upload-sub">JPG / PNG ¬∑ max 4 MB</div>
    </div>

    <div class="preview-wrap" id="previewWrap">
      <img id="previewImg" src="" alt="Screenshot preview">
      <button class="preview-remove" onclick="removeFile()" title="Remove">‚úï</button>
    </div>

    <button class="btn-submit" id="sendBtn" onclick="sendScreenshot()" disabled>
      <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/></svg>
      Send Screenshot to Organiser
    </button>

    <div class="status" id="statusMsg"></div>
  </div>

  <div class="back-row"><a href="index.html">‚Üê Back to Home</a></div>
</div>

<script>
  // ‚îÄ‚îÄ EmailJS setup ‚îÄ‚îÄ
  // HOW TO SET UP (free, 5 min):
  // 1. Go to https://emailjs.com ‚Üí sign up free
  // 2. Add a service: Gmail ‚Üí connect kpaswanth47@gmail.com ‚Üí copy Service ID
  // 3. Create an email template (use variables: {{team}}, {{leader}}, {{members}}, {{amount}}, {{screenshot}})
  // 4. Copy your Public Key from Account ‚Üí API Keys
  // Then fill in the 3 values below:

  const EMAILJS_PUBLIC_KEY  = 'YOUR_PUBLIC_KEY';   // ‚úèÔ∏è from emailjs.com ‚Üí Account
  const EMAILJS_SERVICE_ID  = 'YOUR_SERVICE_ID';   // ‚úèÔ∏è from emailjs.com ‚Üí Email Services
  const EMAILJS_TEMPLATE_ID = 'YOUR_TEMPLATE_ID';  // ‚úèÔ∏è from emailjs.com ‚Üí Email Templates

  emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });

  // ‚îÄ‚îÄ Registration data ‚îÄ‚îÄ
  const reg  = JSON.parse(sessionStorage.getItem('reg_success') || '{}');
  const size = reg.team_size || 1;
  const fee  = size * 250;

  document.getElementById('r-amount').textContent = '‚Çπ' + fee;
  document.getElementById('r-sub').textContent    = size + ' member(s) √ó ‚Çπ250';

  // ‚îÄ‚îÄ Copy UPI ‚îÄ‚îÄ
  function copyUPI() {
    navigator.clipboard.writeText('aswanth2006@oksbi').then(() => {
      const btn = document.getElementById('copyBtn');
      btn.textContent = '‚úì  Copied!'; btn.classList.add('done');
      setTimeout(() => { btn.innerHTML = 'üìã &nbsp;Copy UPI ID'; btn.classList.remove('done'); }, 2500);
    });
  }

  // ‚îÄ‚îÄ File handling ‚îÄ‚îÄ
  let fileBase64 = null;

  function onFileChosen(e) {
    const file = e.target.files[0];
    if (!file) return;
    if (file.size > 4 * 1024 * 1024) { alert('File too large. Please use an image under 4 MB.'); return; }

    const reader = new FileReader();
    reader.onload = (ev) => {
      fileBase64 = ev.target.result; // full data URL
      document.getElementById('previewImg').src = fileBase64;
      document.getElementById('previewWrap').style.display = 'block';
      document.getElementById('uploadZone').style.display  = 'none';
      document.getElementById('sendBtn').disabled = false;
    };
    reader.readAsDataURL(file);
  }

  function removeFile() {
    fileBase64 = null;
    document.getElementById('previewWrap').style.display = 'none';
    document.getElementById('uploadZone').style.display  = 'block';
    document.getElementById('screenshotInput').value = '';
    document.getElementById('sendBtn').disabled = true;
    setStatus('', '');
  }

  // ‚îÄ‚îÄ Send email ‚îÄ‚îÄ
  async function sendScreenshot() {
    if (!fileBase64) return;

    const btn = document.getElementById('sendBtn');
    btn.disabled = true;
    setStatus('sending', '‚è≥ Sending screenshot‚Ä¶ please wait');

    const params = {
      team:       reg.team        || 'Unknown Team',
      leader:     reg.leader_name || 'Unknown',
      members:    size,
      college:    reg.college     || '‚Äî',
      amount:     '‚Çπ' + fee,
      screenshot: fileBase64,   // base64 image attached via EmailJS template
    };

    try {
      await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, params);
      setStatus('sent', '‚úÖ Screenshot sent! We will confirm your registration within 24 hours.');
      btn.textContent = '‚úì Sent!';
    } catch (err) {
      console.error(err);
      setStatus('err', '‚ùå Failed to send. Please WhatsApp the screenshot to the organiser directly.');
      btn.disabled = false;
    }
  }

  function setStatus(type, msg) {
    const el = document.getElementById('statusMsg');
    el.className = 'status ' + type;
    el.textContent = msg;
  }

  // ‚îÄ‚îÄ Drag & drop ‚îÄ‚îÄ
  const zone = document.getElementById('uploadZone');
  zone.addEventListener('dragover',  e => { e.preventDefault(); zone.classList.add('drag'); });
  zone.addEventListener('dragleave', () => zone.classList.remove('drag'));
  zone.addEventListener('drop', e => {
    e.preventDefault(); zone.classList.remove('drag');
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) {
      const dt = new DataTransfer(); dt.items.add(file);
      document.getElementById('screenshotInput').files = dt.files;
      onFileChosen({ target: { files: dt.files } });
    }
  });

  // ‚îÄ‚îÄ Particles ‚îÄ‚îÄ
  const cv = document.getElementById('mainCanvas'), ctx = cv.getContext('2d');
  let W, H, P = [];
  function mkP(){return{x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*.3,vy:(Math.random()-.5)*.3,r:Math.random()*1.2+.5,c:Math.random()<.6?'rgba(255,140,0,':'rgba(255,69,0,'};}
  function rsz(){W=cv.width=innerWidth;H=cv.height=innerHeight;P=[];const n=Math.min(35,~~(W*H/22000));for(let i=0;i<n;i++)P.push(mkP());}
  addEventListener('resize',rsz,{passive:true});rsz();
  (function loop(){
    requestAnimationFrame(loop);ctx.clearRect(0,0,W,H);
    P.forEach(p=>{p.x+=p.vx;p.y+=p.vy;if(p.x<0||p.x>W)p.vx*=-1;if(p.y<0||p.y>H)p.vy*=-1;ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle=p.c+'0.5)';ctx.fill();});
    for(let i=0;i<P.length;i++)for(let j=i+1;j<P.length;j++){const dx=P[i].x-P[j].x,dy=P[i].y-P[j].y,d=Math.sqrt(dx*dx+dy*dy);if(d<100){ctx.beginPath();ctx.moveTo(P[i].x,P[i].y);ctx.lineTo(P[j].x,P[j].y);ctx.strokeStyle=`rgba(255,120,0,${(1-d/100)*.12})`;ctx.lineWidth=.6;ctx.stroke();}}
  })();
</script>
</body>
</html>
