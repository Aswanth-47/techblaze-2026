<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register ‚Äî Tech Blaze 3.0 Hackathon</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@300;400;700&display=swap">
  <link rel="stylesheet" href="style.css">
  <style>
    /* ‚îÄ‚îÄ FIX: Force hide optional members by default ‚îÄ‚îÄ */
    .optional-member {
      display: none !important;
    }
    .optional-member.show {
      display: block !important;
      animation: slideIn .4s ease forwards;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ‚îÄ‚îÄ TEAM SIZE PILLS ‚îÄ‚îÄ */
    .size-pills {
      display: flex; gap: 10px;
    }
    .sz-pill {
      width: 54px; height: 54px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(255,255,255,0.04);
      border: 1.5px solid rgba(255,255,255,0.1);
      border-radius: 12px; font-family: 'Syne', sans-serif;
      font-size: 20px; font-weight: 700;
      color: rgba(255,255,255,0.35);
      cursor: pointer; transition: all .25s;
      user-select: none;
    }
    .sz-pill:hover { border-color: rgba(99,179,237,0.4); color: #fff; background: rgba(99,179,237,0.07); }
    .sz-pill.active { border-color: #63b3ed; background: rgba(99,179,237,0.16); color: #fff; box-shadow: 0 0 18px rgba(99,179,237,0.25); }

    /* Hide the real select; drive via JS */
    #team_size { display: none; }

    /* ‚îÄ‚îÄ MEMBER PROGRESS DOTS ‚îÄ‚îÄ */
    .member-dots {
      display: flex; gap: 7px; margin-bottom: 22px;
    }
    .mdot {
      height: 4px; flex: 1; border-radius: 2px;
      background: rgba(255,255,255,0.07);
      transition: background .35s;
    }
    .mdot.on { background: #63b3ed; }

    /* ‚îÄ‚îÄ PARTICIPANT CARD HEADER ‚îÄ‚îÄ */
    .participant-label {
      display: flex; align-items: center; gap: 10px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px; font-weight: 700; color: rgba(255,255,255,0.4);
      letter-spacing: 0.08em; text-transform: uppercase;
      margin-bottom: 18px; padding-bottom: 14px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .p-num {
      width: 26px; height: 26px; border-radius: 6px;
      background: rgba(99,179,237,0.15); border: 1px solid rgba(99,179,237,0.3);
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: 700; color: #63b3ed; flex-shrink: 0;
    }
    .p-leader { background: rgba(99,179,237,0.12); border: 1px solid rgba(99,179,237,0.25); color: #63b3ed; border-radius: 4px; font-size: 10px; padding: 2px 8px; }
    .p-required { background: rgba(239,83,80,0.12); border: 1px solid rgba(239,83,80,0.2); color: #ef5350; border-radius: 4px; font-size: 10px; padding: 2px 8px; }
    .p-optional  { background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.3); border-radius: 4px; font-size: 10px; padding: 2px 8px; }
  </style>
</head>
<body>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>

  <div class="reg-page">

    <!-- Sidebar -->
    <aside class="reg-sidebar">
      <div>
        <div class="reg-sidebar-logo">
          <div class="sidebar-logo-box">CE</div>
          <span class="sidebar-brand-name">Computer Engineering</span>
        </div>
        <h1 class="reg-sidebar-title">Tech Blaze<br><span class="grad">3.0</span></h1>
        <p class="reg-sidebar-sub">
          Register your team and secure your spot at the biggest hackathon of the year. Teams of up to 4 members welcome.
        </p>
        <div class="reg-steps">
          <div class="reg-step active" id="si1"><div class="step-num">1</div>Team Information</div>
          <div class="reg-step" id="si2"><div class="step-num">2</div>Team Members</div>
          <div class="reg-step" id="si3"><div class="step-num">3</div>Health & Preferences</div>
        </div>
      </div>
      <div class="sidebar-footer">
        <p>Questions? Reach out to the organising team.</p>
        <p style="margin-top:4px">¬© 2026 CE Department</p>
      </div>
    </aside>

    <!-- Main -->
    <main class="reg-main">
      <div class="reg-main-header fade-up fade-up-1">
        <h2 class="reg-main-title">Team Registration</h2>
        <p class="reg-main-sub">Fields marked with <span class="asterisk">*</span> are required</p>
      </div>

      <form id="hackForm" class="fade-up fade-up-2" novalidate>

        <!-- STEP 1 -->
        <div class="form-section" id="fs1">
          <div class="form-section-title">Step 1 ‚Äî Team Details</div>
          <div class="form-row">
            <div class="form-group full">
              <label>Team Name *</label>
              <input id="team" name="team" type="text" placeholder="e.g. ByteForce, NullPointers, CodeNinjas‚Ä¶" required autocomplete="off">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>College / Institution *</label>
              <input id="college" name="college" type="text" placeholder="Your college name" required autocomplete="off">
            </div>
            <div class="form-group">
              <label>Team Size *</label>
              <div class="size-pills">
                <div class="sz-pill" data-n="1" onclick="setSize(1)">1</div>
                <div class="sz-pill" data-n="2" onclick="setSize(2)">2</div>
                <div class="sz-pill" data-n="3" onclick="setSize(3)">3</div>
                <div class="sz-pill" data-n="4" onclick="setSize(4)">4</div>
              </div>
              <select id="team_size" name="team_size" required>
                <option value="">Select</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
              </select>
            </div>
          </div>
        </div>

        <!-- STEP 2 -->
        <div class="form-section" id="fs2">
          <div class="form-section-title">Step 2 ‚Äî Team Members</div>

          <!-- Member progress bar -->
          <div class="member-dots">
            <div class="mdot on" id="md1"></div>
            <div class="mdot" id="md2"></div>
            <div class="mdot" id="md3"></div>
            <div class="mdot" id="md4"></div>
          </div>

          <!-- P1 ‚Äî always visible -->
          <div class="participant-card required-member">
            <div class="participant-label">
              <div class="p-num">1</div>
              Team Leader
              <span class="p-leader">Leader</span>
              <span class="p-required">Required</span>
            </div>
            <div class="form-row">
              <div class="form-group full">
                <label>Full Name *</label>
                <input name="p1" type="text" placeholder="Full name" required autocomplete="off">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Mobile Number *</label>
                <input name="p1_phone" type="tel" placeholder="10-digit (starts 6‚Äì9)" pattern="[6-9]\d{9}" required maxlength="10" inputmode="numeric">
              </div>
              <div class="form-group">
                <label>Email Address *</label>
                <input name="p1_email" type="email" placeholder="leader@email.com" required autocomplete="off">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Food Preference *</label>
                <select name="p1_food" required>
                  <option value="">Select option</option>
                  <option value="Vegetarian">ü•¶ Vegetarian</option>
                  <option value="Non-Vegetarian">üçó Non-Vegetarian</option>
                </select>
              </div>
            </div>
          </div>

          <!-- P2 ‚Äî hidden until size >= 2 -->
          <div class="participant-card optional-member" id="p2c">
            <div class="participant-label">
              <div class="p-num">2</div>
              Member 2
              <span class="p-optional">Optional</span>
            </div>
            <div class="form-row">
              <div class="form-group full">
                <label>Full Name</label>
                <input name="p2" type="text" placeholder="Full name" autocomplete="off">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Mobile Number</label>
                <input name="p2_phone" type="tel" placeholder="10-digit mobile" pattern="[6-9]\d{9}" maxlength="10" inputmode="numeric">
              </div>
              <div class="form-group">
                <label>Email Address</label>
                <input name="p2_email" type="email" placeholder="member2@email.com" autocomplete="off">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Food Preference</label>
                <select name="p2_food">
                  <option value="">Select option</option>
                  <option value="Vegetarian">ü•¶ Vegetarian</option>
                  <option value="Non-Vegetarian">üçó Non-Vegetarian</option>
                </select>
              </div>
            </div>
          </div>

          <!-- P3 ‚Äî hidden until size >= 3 -->
          <div class="participant-card optional-member" id="p3c">
            <div class="participant-label">
              <div class="p-num">3</div>
              Member 3
              <span class="p-optional">Optional</span>
            </div>
            <div class="form-row">
              <div class="form-group full">
                <label>Full Name</label>
                <input name="p3" type="text" placeholder="Full name" autocomplete="off">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Mobile Number</label>
                <input name="p3_phone" type="tel" placeholder="10-digit mobile" pattern="[6-9]\d{9}" maxlength="10" inputmode="numeric">
              </div>
              <div class="form-group">
                <label>Email Address</label>
                <input name="p3_email" type="email" placeholder="member3@email.com" autocomplete="off">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Food Preference</label>
                <select name="p3_food">
                  <option value="">Select option</option>
                  <option value="Vegetarian">ü•¶ Vegetarian</option>
                  <option value="Non-Vegetarian">üçó Non-Vegetarian</option>
                </select>
              </div>
            </div>
          </div>

          <!-- P4 ‚Äî hidden until size = 4 -->
          <div class="participant-card optional-member" id="p4c">
            <div class="participant-label">
              <div class="p-num">4</div>
              Member 4
              <span class="p-optional">Optional</span>
            </div>
            <div class="form-row">
              <div class="form-group full">
                <label>Full Name</label>
                <input name="p4" type="text" placeholder="Full name" autocomplete="off">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Mobile Number</label>
                <input name="p4_phone" type="tel" placeholder="10-digit mobile" pattern="[6-9]\d{9}" maxlength="10" inputmode="numeric">
              </div>
              <div class="form-group">
                <label>Email Address</label>
                <input name="p4_email" type="email" placeholder="member4@email.com" autocomplete="off">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Food Preference</label>
                <select name="p4_food">
                  <option value="">Select option</option>
                  <option value="Vegetarian">ü•¶ Vegetarian</option>
                  <option value="Non-Vegetarian">üçó Non-Vegetarian</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 3 -->
        <div class="form-section" id="fs3">
          <div class="form-section-title">Step 3 ‚Äî Health & Accessibility</div>
          <div class="form-group full">
            <label for="medical">Medical Conditions or Accessibility Needs</label>
            <textarea id="medical" name="medical" rows="4" placeholder="Let us know if any team member has allergies, medical conditions, or accessibility requirements‚Ä¶"></textarea>
          </div>
        </div>

        <button type="submit" class="btn-submit" id="submitBtn">Submit Registration ‚Üí</button>
        <p class="form-note">By submitting, you agree to the event terms & code of conduct.</p>
      </form>
    </main>
  </div>

  <script>
    window.scrollTo(0, 0);
    setTimeout(() => document.documentElement.classList.add('loaded'), 100);

    // ‚îÄ‚îÄ TEAM SIZE PILL SELECTOR ‚îÄ‚îÄ
    let currentSize = 0;

    function setSize(n) {
      currentSize = n;

      // Update hidden select
      document.getElementById('team_size').value = n;

      // Update pill styles
      document.querySelectorAll('.sz-pill').forEach(p => {
        p.classList.toggle('active', parseInt(p.dataset.n) === n);
      });

      // Show/hide member cards
      // p2c shows when n >= 2, p3c when n >= 3, p4c when n == 4
      const cards = { p2c: 2, p3c: 3, p4c: 4 };
      Object.entries(cards).forEach(([id, minSize]) => {
        const card = document.getElementById(id);
        if (n >= minSize) {
          card.classList.add('show');
        } else {
          card.classList.remove('show');
          // Clear fields of hidden cards
          card.querySelectorAll('input, select').forEach(f => f.value = '');
        }
      });

      // Update progress dots
      for (let i = 1; i <= 4; i++) {
        const d = document.getElementById('md' + i);
        if (d) d.classList.toggle('on', i <= n);
      }
    }

    // ‚îÄ‚îÄ PHONE INPUT: digits only ‚îÄ‚îÄ
    document.querySelectorAll('input[type="tel"]').forEach(el => {
      el.addEventListener('input', e => {
        e.target.value = e.target.value.replace(/\D/g, '').slice(0, 10);
      });
    });

    // ‚îÄ‚îÄ CARD FOCUS HIGHLIGHT ‚îÄ‚îÄ
    document.querySelectorAll('input, textarea, select').forEach(el => {
      el.addEventListener('focus', () => el.closest('.participant-card')?.classList.add('focused'));
      el.addEventListener('blur',  () => el.closest('.participant-card')?.classList.remove('focused'));
    });

    // ‚îÄ‚îÄ STEP INDICATOR ‚îÄ‚îÄ
    const fss = [document.getElementById('fs1'), document.getElementById('fs2'), document.getElementById('fs3')];
    const sis = [document.getElementById('si1'), document.getElementById('si2'), document.getElementById('si3')];
    if (fss[0] && sis[0]) {
      const sio = new IntersectionObserver(entries => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            const i = fss.indexOf(e.target);
            sis.forEach((s, j) => s.classList.toggle('active', j === i));
          }
        });
      }, { threshold: 0.5 });
      fss.forEach(s => sio.observe(s));
    }

    // ‚îÄ‚îÄ VALIDATION ‚îÄ‚îÄ
    const validPhone = p => /^[6-9]\d{9}$/.test(p);
    const validEmail = e => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);
    const val = name => (document.querySelector(`[name="${name}"]`)?.value || '').trim();

    // ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
    function toast(msg, type = 'error') {
      document.querySelector('.toast')?.remove();
      const t = document.createElement('div');
      t.className = 'toast';
      t.textContent = msg;
      const c = { error: '#ef5350', success: '#66bb6a', info: '#29b6f6' }[type];
      t.style.cssText = `position:fixed;bottom:28px;right:28px;padding:16px 24px;background:${c};color:#fff;font-family:'Syne',sans-serif;font-size:14px;font-weight:600;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.5);z-index:9999;max-width:400px;animation:tin .3s ease;`;
      document.head.insertAdjacentHTML('beforeend','<style>@keyframes tin{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}</style>');
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 4000);
    }

    // ‚îÄ‚îÄ FORM SUBMIT ‚îÄ‚îÄ
    document.getElementById('hackForm').addEventListener('submit', async e => {
      e.preventDefault();

      if (!currentSize) { toast('Please select your team size first'); return; }
      if (!val('team'))  { toast('Please enter your team name'); return; }
      if (!val('college')) { toast('Please enter your college name'); return; }
      if (!val('p1'))    { toast('Please enter Team Leader name'); return; }
      if (!validPhone(val('p1_phone'))) { toast('Team Leader: Enter a valid 10-digit mobile starting with 6‚Äì9'); return; }
      if (!validEmail(val('p1_email'))) { toast('Team Leader: Enter a valid email address'); return; }
      if (!val('p1_food')) { toast('Team Leader: Please select food preference'); return; }

      // Validate each visible extra member
      for (let i = 2; i <= currentSize; i++) {
        const name = val(`p${i}`);
        if (!name) { toast(`Member ${i}: Please enter full name`); return; }
        if (!validPhone(val(`p${i}_phone`))) { toast(`Member ${i}: Invalid mobile number`); return; }
        if (!validEmail(val(`p${i}_email`))) { toast(`Member ${i}: Invalid email address`); return; }
        if (!val(`p${i}_food`)) { toast(`Member ${i}: Please select food preference`); return; }
      }

      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      btn.textContent = 'Submitting‚Ä¶';

      const payload = {
        team: val('team'), college: val('college'),
        team_size: currentSize, medical: val('medical'),
        p1: val('p1'), p1_phone: val('p1_phone'), p1_email: val('p1_email'), p1_food: val('p1_food'),
        p2: val('p2'), p2_phone: val('p2_phone'), p2_email: val('p2_email'), p2_food: val('p2_food'),
        p3: val('p3'), p3_phone: val('p3_phone'), p3_email: val('p3_email'), p3_food: val('p3_food'),
        p4: val('p4'), p4_phone: val('p4_phone'), p4_email: val('p4_email'), p4_food: val('p4_food'),
      };

      try {
        const res = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await res.json();

        if (data.success) {
          sessionStorage.setItem('reg_success', JSON.stringify(data));
          window.location.href = 'success.html';
        } else {
          btn.disabled = false;
          btn.textContent = 'Submit Registration ‚Üí';
          const msgs = {
            duplicate: '‚ö†Ô∏è This phone or email is already registered!',
            invalid_phone: '‚ö†Ô∏è Invalid phone number.',
            invalid_email: '‚ö†Ô∏è Invalid email address.',
            missing_fields: '‚ö†Ô∏è Please fill all required fields.',
            server_error: '‚ùå Server error. Please try again.',
          };
          toast(msgs[data.error] || '‚ùå Something went wrong. Please try again.');
        }
      } catch {
        btn.disabled = false;
        btn.textContent = 'Submit Registration ‚Üí';
        toast('‚ùå Network error. Please try again.');
      }
    });
  </script>
</body>
</html>
